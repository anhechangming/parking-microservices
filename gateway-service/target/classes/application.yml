server:
  port: 8080

spring:
  application:
    name: gateway-service  # 服务名称

  # Nacos 服务注册与发现配置
  cloud:
    nacos:
      discovery:
        server-addr: ${SPRING_CLOUD_NACOS_DISCOVERY_SERVER_ADDR:localhost:8848}  # Nacos地址
        namespace: dev  # 命名空间（使用环境变量或默认为空）
        enabled: true  # 启用服务注册

    # Spring Cloud Gateway 配置
    gateway:
      # 路由配置
      routes:
        # 用户服务路由
        - id: user-service
          uri: lb://user-service  # lb表示使用负载均衡，从Nacos获取服务实例
          predicates:
            - Path=/user/**  # 路径匹配
          filters:
            - StripPrefix=1  # 移除 /user 前缀

        # 停车场服务路由
        - id: parking-service
          uri: lb://parking-service
          predicates:
            - Path=/parking/**
          filters:
            - StripPrefix=1  # 移除 /parking 前缀

        # 停车费服务路由
        - id: fee-service
          uri: lb://fee-service
          predicates:
            - Path=/fee/**
          filters:
            - StripPrefix=1  # 移除 /fee 前缀

      # 全局CORS配置
      globalcors:
        cors-configurations:
          '[/**]':
            allowedOrigins: "*"
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
              - OPTIONS
            allowedHeaders: "*"
            allowCredentials: false
            maxAge: 3600

      # 服务发现配置
      discovery:
        locator:
          enabled: true  # 启用服务发现路由
          lower-case-service-id: true  # 服务名称小写

# JWT配置
jwt:
  secret: parking-management-system-jwt-secret-key-2025-microservices-project  # JWT密钥（生产环境应使用环境变量）
  expiration: 86400000  # Token过期时间（毫秒）24小时
  header: Authorization  # Token请求头名称
  prefix: Bearer   # Token前缀

# 认证白名单（这些路径不需要JWT验证）
auth:
  whitelist: "/user/auth/**,/actuator/**,/favicon.ico"

# 日志配置
logging:
  level:
    com.parking.gateway: debug
    org.springframework.cloud.gateway: info
  pattern:
    console: '%d{yyyy-MM-dd HH:mm:ss} [${spring.application.name}:${server.port}] - %msg%n'

# Actuator配置
management:
  endpoints:
    web:
      exposure:
        include: health,info,gateway
  endpoint:
    health:
      show-details: always
